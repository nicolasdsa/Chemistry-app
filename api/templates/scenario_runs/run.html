{% extends "base.html" %}

{% block title %}Executando cenário{% endblock %}

{% block content %}
  <section>
    <h2>{{ scenario.title }}</h2>
    <p>{{ scenario.description }}</p>

    {% if scenario.steps %}
      <h3>Passos planejados</h3>
      <ol>
        {% for step in scenario.steps %}
          <li>{{ step.text_instruction }}</li>
        {% endfor %}
      </ol>
    {% endif %}
  </section>

  <section id="run-state"
           hx-get="/ui/scenario-runs/{{ run_state.run_id }}/state"
           hx-trigger="load"
           hx-target="#run-state"
           hx-swap="innerHTML">
    Carregando estado da simulação...
  </section>

  <section>
  <h2>Testar ação</h2>
  <form
    hx-post="/ui/scenario-runs/{{ run_state.run_id }}/actions"
    hx-target="#run-state"
    hx-swap="innerHTML">

    <label>Ação:</label>
    <select name="action_type">
      <option value="transfer_solid_with_spatula">Transferir sólido com espátula</option>
      <option value="transfer_liquid_with_pipette">Transferir líquido com pipeta</option>
      <option value="pour_liquid_between_containers">Despejar entre recipientes</option>
    </select>

    <label>Instrumento:</label>
    <select name="instrument_id">
      <option value="">(Opcional / não se aplica)</option>
      {% for inst in instruments %}
        <option value="{{ inst.id }}">
          {{ inst.name }} ({{ inst.instrument_type }})
        </option>
      {% endfor %}
    </select>

    <label>Recipiente de origem:</label>
    <select name="source_container_name">
      <option value="">Sem recipiente de origem (estoque)</option>
      {% for name in container_names %}
        <option value="{{ name }}">{{ name }}</option>
      {% endfor %}
    </select>

    <label>Recipiente de destino:</label>
    <select name="target_container_name">
      <option value="">(Selecione)</option>
      {% for name in container_names %}
        <option value="{{ name }}">{{ name }}</option>
      {% endfor %}
    </select>

    <label>Reagente:</label>
    <select name="reagent_id">
      <option value="">(Selecione)</option>
      {% for reagent in reagents %}
        <option value="{{ reagent.id }}">
          {{ reagent.name }} ({{ reagent.physical_state }})
        </option>
      {% endfor %}
    </select>

    <label>Quantidade:</label>
    <input type="number" step="0.1" name="amount_value" />

    <label>Unidade:</label>
    <select name="amount_unit">
      <option value="">(Selecione)</option>
      <option value="g">g</option>
      <option value="mL">mL</option>
      <option value="drop">gotas</option>
    </select>

    <button type="submit">Aplicar ação</button>
  </form>
</section>

{% endblock %}
